function init(){var a=2*cards.length;rows=Math.sqrt(a),columns=rows,header.innerHTML="Points: "+points;for(var b=0;rows>b;b++){var c=document.createElement("div"),d=[];copyOfColors=colors.slice(),c.classList.add("obox"),main.appendChild(c);for(var e=0;columns>e;e++){var f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("div");f.classList.add("ibox"),g.classList.add("flipper"),h.classList.add("front"),i.classList.add("back"),color=getRandomColor(b,e,d),h.style.background=color,c.appendChild(f),f.appendChild(g),g.appendChild(h),g.appendChild(i)}prevLine.push(d)}for(var b=0;b<boxes.length;b++){var j=Math.round(Math.random()*boxes.length);boxes[b].style.opacity="0",setTimeout(showBox,100*j,b)}cards.forEach(function(a,b,c){a.id=b,c.push(a)}),shuffle(cards);for(var b in cards)backs[b].innerHTML=cards[b].icon,flippers[b].setAttribute("id",cards[b].id),boxes[b].addEventListener("click",flipCard);mainContent.style.width=2*boxes[0].offsetWidth+"px",mainContent.style.top=2*boxes[0].offsetHeight+"px"}function flipCard(a){var b={flipper:a.path[1],box:a.path[2]};b.flipper.style.transition="transform .6s",b.flipper.style.transform="rotateY(180deg)",b.box.removeEventListener("click",flipCard),viewCount++,matchedCards.push(b),2==matchedCards.length?matchedCards[0].flipper.id===matchedCards[1].flipper.id&&2==viewCount?(setTimeout(function(){animationPoints(0),animationPoints(1)},400),points+=5,gameStatus++,viewCount=0,gameStatus==cards.length/2&&endGame()):matchedCards[0].flipper.id===matchedCards[1].flipper.id&&(setTimeout(function(){animationPoints(0),animationPoints(1)},400),points++,gameStatus++,viewCount=0,gameStatus==cards.length/2&&endGame()):matchedCards.length>2&&(matchedCards[0].flipper.id!=matchedCards[1].flipper.id&&(matchedCards[0].flipper.style.transform="rotateY(0deg)",matchedCards[1].flipper.style.transform="rotateY(0deg)",matchedCards[0].box.addEventListener("click",flipCard),matchedCards[1].box.addEventListener("click",flipCard)),matchedCards.splice(0,2)),cardToMatch=b,document.querySelector("header.header").innerHTML="Points: "+points}function endGame(){mainContent.style.display="block",showScore.querySelector("p").innerHTML=points;var a=highscore.sort(function(a,b){return b.score-a.score});if(a.length>0){for(var b in a)if(points>a[b].score){showScore.style.display="none",addScore.style.display="block",document.getElementById("button").addEventListener("click",function(){addToHighscore(b,a)});break}}else showScore.style.display="none",addScore.style.display="block",document.getElementById("button").addEventListener("click",function(){addToHighscore(b,a)});for(var c in a){var d=document.createElement("li");d.innerHTML=a[c].name+": "+a[c].score,document.querySelector("#highscore-board ul").appendChild(d)}}function addToHighscore(a,b){var c=document.getElementById("nameInput").value;if(b.splice(a,0,{name:c,score:points}),b.length>10&&b.pop(),b.length>0){var d=[].slice.call(document.querySelectorAll("#highscore-board ul li"));for(var e in d)d[e].innerHTML=b[e].name+": "+b[e].score;d[a].style.background="#FF3800",d[a].style.color="#FFF",d[a].style.padding="5px"}addScore.style.display="none",saveJSONtoServer(b)}function saveJSONtoServer(a){var b=JSON.stringify({Cards:initCards,Highscore:a}),c=new XMLHttpRequest;c.open("POST","../../assets/JSONhandler.php",!0),c.setRequestHeader("Content-type","application/json"),c.send(b)}function shuffle(a){var b,c,d;for(d=a.length;d;d-=1)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c}function showBox(a){boxes[a].style.transition="opacity 0.5s linear 0s",boxes[a].style.opacity="1",flippers[a].style.height=boxes[a].offsetHeight+"px",fronts[a].style.width=boxes[a].offsetWidth+"px",fronts[a].style.height=boxes[a].offsetHeight+"px",backs[a].style.width=boxes[a].offsetWidth+"px",backs[a].style.height=boxes[a].offsetHeight+"px"}function getRandomColor(a,b,c){var d,e=Math.round(Math.random()*(copyOfColors.length-1));return prevLine.length>0?0==b?(d=prevLine[a-1][columns-1],e=copyOfColors.indexOf(prevLine[a-1][columns-1])):b>0&&prevLine[a-1][b]===copyOfColors[e]?e<copyOfColors.length-1?d=copyOfColors[e+=1]:1!=copyOfColors.length&&(d=copyOfColors[e-=1]):d=copyOfColors[e]:d=copyOfColors[e],c.push(copyOfColors[e]),copyOfColors.splice(e,1),d}function animationPoints(a){var b=matchedCards[a].flipper.querySelector("div.back");b.querySelector("i");new Animocon(b,{tweens:[new mojs.Burst({parent:b,duration:1500,shape:"circle",fill:["#7F344D","#DE8AA0","#8AAEDE","#8ADEAD","#DEC58A","#8AD1DE"],x:"50%",y:"50%",opacity:.6,childOptions:{radius:{20:0}},radius:{40:120},count:6,isSwirl:!0,isRunLess:!0,easing:mojs.easing.bezier(.1,1,.3,1)}),new mojs.Transit({parent:b,duration:750,type:"circle",radius:{0:50},fill:"transparent",stroke:"#40212F",strokeWidth:{15:0},opacity:.6,x:"50%",y:"50%",isRunLess:!0,easing:mojs.easing.bezier(0,1,.5,1)})],onCheck:function(){b.style.color="#40212F"},onUnCheck:function(){b.style.color="#C0C1C3"}})}function Animocon(a,b){function c(){f.checked?f.options.onUnCheck():(f.options.onCheck(),f.timeline.start()),f.checked=!f.checked}this.el=a,this.options=extend({},this.options),extend(this.options,b),this.checked=!1,this.timeline=new mojs.Timeline;for(var d=0,e=this.options.tweens.length;e>d;++d)this.timeline.add(this.options.tweens[d]);var f=this;c()}function extend(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var main=document.getElementById("main-container"),boxes=document.getElementsByClassName("ibox"),flippers=document.getElementsByClassName("flipper"),fronts=document.getElementsByClassName("front"),backs=document.getElementsByClassName("back"),mainContent=document.getElementById("main-content"),header=document.querySelector("header.header"),addScore=document.getElementById("add-score"),showScore=document.getElementById("show-score"),colors=["#CC6996","#8D4867","#40212F","#4D2838","#331A25","#FF85BB"],prevLine=[],current,rows=5,columns=6,usedBoxes=[],matchedCards=[],points=0,viewCount=0,gameStatus=0,xmlhttp=new XMLHttpRequest;xmlhttp.overrideMimeType("application/json");var url="assets/memory.json",cards=[],initCards=[],highscore=[];xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var a=JSON.parse(xmlhttp.responseText);cards=a.Cards,initCards=cards.slice(),highscore=a.Highscore,init()}},xmlhttp.open("GET",url,!0),xmlhttp.send(),Animocon.prototype.options={tweens:[new mojs.Burst({shape:"circle",isRunLess:!0})],onCheck:function(){return!1},onUnCheck:function(){return!1}};