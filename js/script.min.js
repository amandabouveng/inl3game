function init(){var a=2*cards.length;rows=Math.sqrt(a),columns=rows,header.innerHTML="Points: "+points;for(var b=0;rows>b;b++){var c=document.createElement("div"),d=[];copyOfColors=colors.slice(),c.classList.add("obox"),main.appendChild(c);for(var e=0;columns>e;e++){var f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),i=document.createElement("div");f.classList.add("ibox"),g.classList.add("flipper"),h.classList.add("front"),i.classList.add("back"),color=getRandomColor(b,e,d),h.style.background=color,c.appendChild(f),f.appendChild(g),g.appendChild(h),g.appendChild(i)}prevLine.push(d)}for(var b=0;b<boxes.length;b++){var j=Math.round(Math.random()*boxes.length);boxes[b].style.opacity="0",setTimeout(showBox,100*j,b)}cards.forEach(function(a,b,c){a.id=b,c.push(a)}),shuffle(cards);for(var b in cards)backs[b].innerHTML=cards[b].icon,flippers[b].setAttribute("id",cards[b].id),boxes[b].addEventListener("click",flipCard);mainContent.style.width=2*boxes[0].offsetWidth+"px",mainContent.style.height=2*boxes[0].offsetHeight+5+"px",mainContent.style.top=2*boxes[0].offsetHeight+"px"}function flipCard(a){var b={flipper:a.path[1],box:a.path[2]};b.flipper.style.transition="transform .6s",b.flipper.style.transform="rotateY(180deg)",b.box.removeEventListener("click",flipCard),viewCount++,matchedCards.push(b),2==matchedCards.length?matchedCards[0].flipper.id===matchedCards[1].flipper.id&&2==viewCount?(points+=5,gameStatus++,viewCount=0,gameStatus==cards.length/2&&endGame()):matchedCards[0].flipper.id===matchedCards[1].flipper.id&&(points++,gameStatus++,viewCount=0,gameStatus==cards.length/2&&endGame()):matchedCards.length>2&&(matchedCards[0].flipper.id!=matchedCards[1].flipper.id&&(matchedCards[0].flipper.style.transform="rotateY(0deg)",matchedCards[1].flipper.style.transform="rotateY(0deg)",matchedCards[0].box.addEventListener("click",flipCard),matchedCards[1].box.addEventListener("click",flipCard)),matchedCards.splice(0,2)),cardToMatch=b,document.querySelector("header.header").innerHTML="Points: "+points}function endGame(){mainContent.style.display="block";var a=highscore.sort(function(a,b){return b.score-a.score});for(var b in a)if(points>a[b].score){addScore.style.display="block",document.getElementById("button").addEventListener("click",function(){addToHighscore(b,a)});break}for(var b in a){var c=document.createElement("li");c.innerHTML=a[b].name+": "+a[b].score,document.querySelector("#highscore-board ul").appendChild(c)}}function addToHighscore(a,b){var c=document.getElementById("nameInput").value;b.splice(a,0,{name:c,score:points}),b.length>10&&b.pop();var d=[].slice.call(document.querySelectorAll("#highscore-board ul li"));for(var e in d)d[e].innerHTML=b[e].name+": "+b[e].score;saveJSONtoServer(b)}function saveJSONtoServer(a){var b=JSON.stringify({Cards:initCards,Highscore:a}),c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status},c.open("POST","../../assets/JSONhandler.php",!0),c.setRequestHeader("Content-type","application/json"),c.send(b)}function shuffle(a){var b,c,d;for(d=a.length;d;d-=1)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c}function showBox(a){boxes[a].style.transition="opacity 0.5s linear 0s",boxes[a].style.opacity="1",flippers[a].style.height=boxes[a].offsetHeight+"px",fronts[a].style.width=boxes[a].offsetWidth+"px",fronts[a].style.height=boxes[a].offsetHeight+"px",backs[a].style.width=boxes[a].offsetWidth+"px",backs[a].style.height=boxes[a].offsetHeight+"px"}function getRandomColor(a,b,c){var d,e=Math.round(Math.random()*(copyOfColors.length-1));return prevLine.length>0?0==b?(d=prevLine[a-1][columns-1],e=copyOfColors.indexOf(prevLine[a-1][columns-1])):b>0&&prevLine[a-1][b]===copyOfColors[e]?e<copyOfColors.length-1?d=copyOfColors[e+=1]:1!=copyOfColors.length&&(d=copyOfColors[e-=1]):d=copyOfColors[e]:d=copyOfColors[e],c.push(copyOfColors[e]),copyOfColors.splice(e,1),d}function getRandomFlipper(){var a={randomNumber:Math.round(Math.random()*flippers.length),flipper:function(){return flippers[this.randomNumber]}};return a}var main=document.getElementById("main-container"),boxes=document.getElementsByClassName("ibox"),flippers=document.getElementsByClassName("flipper"),fronts=document.getElementsByClassName("front"),backs=document.getElementsByClassName("back"),mainContent=document.getElementById("main-content"),header=document.querySelector("header.header"),addScore=document.getElementById("add-score"),colors=["rgba(0, 165, 191, 0.5)","rgba(0, 110, 127, 0.5)","rgba(0, 221, 255, 0.5)","rgba(0, 55, 64, 0.5)","rgba(0, 199, 229, 0.5)","rgba(27,120,127,0.5)"],prevLine=[],current,rows=5,columns=6,usedBoxes=[],matchedCards=[],points=0,viewCount=0,gameStatus=0,xmlhttp=new XMLHttpRequest;xmlhttp.overrideMimeType("application/json");var url="assets/memory.json",cards=[],initCards=[],highscore=[];xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var a=JSON.parse(xmlhttp.responseText);cards=a.Cards,initCards=cards.slice(),highscore=a.Highscore,init()}},xmlhttp.open("GET",url,!0),xmlhttp.send();